# 5장 라우터/L3 스위치 : 3계층 장비

- 라우터 : 3계층에서 동작하는 네트워크 장비의 대표. 경로를 지정해줌.
- 라우터에 들어오는 패킷의 목적지 IP 주소를 확인 -> 자신이 가진 경로 정보를 이용해 패킷을 최적의 경로로 포워딩 함.
- 원격지 네트워크와 연결할 때 필수 네트워크 장비.



## 5.1 라우터의 동작 방식과 역할

- 라우터는 다양한 경로 정보를 수집해 최적의 경로를 라우팅 테이블에 저장함.
- 패킷이 라우터로 들어오면 도착지 IP 주소와 라우팅 테이블을 비교해 최선의 경로로 패킷을 내보냄.
- 들어온 패킷의 목적지 주소가 라우팅 테이블에 없으면 패킷을 버림.
- 패킷 포워딩 과정에서 기존 2계층 헤더 정보를 제거한 후 새로운 2계층 헤더를 만듦.



### 5.1.1 경로 지정

- 라우터의 가장 중요한 역할. 
- 경로 정보를 모아 라우팅 테이블을 만들고 패킷이 라우터로 들어오면 패킷의 도착지 IP 주소를 확인해 경로를 지정하고 패킷을 포워딩함. 
- IP 주소는 네트워크 주소와 호스트 주소로 나뉜 계층 구조를 기반으로 설계되어 로컬 네트워크와 원격지 네트 워크를 구분할 수 있고 네트워크 주소를 기반으로 경로를 찾아갈 수 있음. 
- 라우터는 이 IP 주소를 확인해 원격지에 있는 적절한 경로로 패킷을 포워딩함. 
- 라우터는 경로를 지정해 패킷을 포워딩하는 역할을 두 가지로 구분 해 수행함. 
- 경로 정보를 얻는 역할과 얻은 경로 정보를 확인하고 패킷을 포워딩하는 역할.
- 라우터는 자신이 얻은 경로 정보에 포함되는 패킷만 포워딩하므로 정확한 목적지 경로를 얻는 것이 매우 중요함. 
- 다양한 방법으로 경로 정보를 얻을 수 있는데 1) IP 주소를 입력하면서 자연스럽게 인접 네트워크 정보를 얻는 방법과 2) 관리자가 직접 경로 정보를 입력하는 방법, 3) 라우터끼리 서로 경로 정보를 자동으로 교환하는 방법이 있음.

![image-20211128002356400](C:\Users\tkrhk\AppData\Roaming\Typora\typora-user-images\image-20211128002356400.png)

### 5.1.2 브로드캐스트 컨트롤 (Broadcase Control)

- 라우터는 패킷을 원격지로 보내는 것을 목표로 개발되어 3계층에서 동작하고 분명한 도착지 정보가 있을 때만 통신을 허락함. 
- 인터넷 연결은 대부분 지정된 대역폭만 빌려 사용하므로 쓸모없는 통신이 네트워크를 차지하는 것을 최대한 막으려고 노력함. 
- 만약 LAN에서 스위치가 동작하는 것처럼 목적지가 없거나 명확하지 않은 패킷이 플러딩된다면 인터넷에 쓸모 없는 패킷이 가득차 통신 불능 상태가 될 수 있음. 
- 라우터는 바로 연결되어 있는 네트워크 정보를 제외하고 경로 습득 설정을 하지 않으면 패킷을 포워딩할 수 없음. 
- 라우터의 기본 동작은 멀티캐스트 정보를 습득하지 않고 브로드캐스트 패킷을 전달하지 않음. 

### 5.1.3 프로토콜 변환

- 라우터의 또 다른 역할은 서로 다른 프로토콜로 구성된 네트워크를 연결하는 것.
- ![image-20211128003551352](C:\Users\tkrhk\AppData\Roaming\Typora\typora-user-images\image-20211128003551352.png)



## 5.2 경로 지정 - 라우팅/스위칭

### 5.2.1 라우팅 동작과 라우팅 테이블

- 현대 인터넷에서는 단말부터 목적지까지의 경로를 모두 책임지는 것이 아니라 인접한 라우터까지만 경로를 지정하면 인접 라우터에서 최적의 경로를 다시 파악한 후 라우터로 패킷을 포워딩함. 
- 네트 워크를 한 단계씩 뛰어넘는다는 의미로 이 기법을 홉-바이-홉(Hop-b y-Hop) 라우팅이라고 부르고 인접한 라우터를 넥스트 홉(Next Hop)이 라고 부름. 
- 라우터는 패킷이 목적지로 가는 전체 경로를 파악하지 않고 최적의 넥스트 홉을 선택해 보내줌.

![image-20211128003833675](C:\Users\tkrhk\AppData\Roaming\Typora\typora-user-images\image-20211128003833675.png)



# 5.3 라우팅 설정 방법

## 5.3.1 다이렉트 커넥티드

![image-20211128004017577](C:\Users\tkrhk\AppData\Roaming\Typora\typora-user-images\image-20211128004017577.png)

- 라우팅 테이블을 확인해 목적지가 다이렉트 커넥티드라면 라우터는 앞장에서 배웠던 L2 통신(ARP 요청을 직접 보내는)으로 목적지에 도달함. 
- 목적지가 외부 네트워크인데 다이렉트 커넥티드 라우팅 테이블 정보만 있으면 외부 네트워크와 통신이 불가능함. 
- 외부 네트워크로 통신하려면 다이렉트 커넥티드 외에 스태틱 라우팅이나 다이나믹 라우팅에서 얻은 원격지 네트워크에 대한 적절한 라우팅 정보가 있어야 함.