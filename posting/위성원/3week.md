# 3.3 IP 주소

- OSI 7계층에서 주소를 갖는 계층은 2, 3계층.
- 2계층은 물리 주소인 MAC주소를 사용하고 3계층은 논리 주소인 IP주소를 사용함.
- 대부분의 네트워크가 TCP/IP로 동작하므로 IP 주소 체계를 이해하는 것이 네트워크 이해에 매우 중요.

### **IP 주소 체계**

- 우리가 주로 사용하는 IP 주소는 32비트인 IPv4주소.
- IP는 v4, v6두 체계가 사용되며 IPv6주소는 128비트.
- IPv4주소를 표기할 때는 4개의 옥텟이라고 부르는 8비트 단위로 나누고 각옥텟은 '.'으로 구분함.
- IP주소는 10진수로 표기하므로 8비트 옥텟은 0~255의 값을 쓸 수 있음.
- 3계층 주소인 IP주소는 네트워크 주소와 호스트 주소 두부분으로 나뉨.

![image](https://user-images.githubusercontent.com/52841715/140639904-b6f37696-616a-4d3d-ac01-cd0111e9166b.png)


**네트워크 주소**

- 호스트들을 모은 네트워크를 지칭하는 주소. 네트워크 주소가 동일한 네트워크를 로컬 네트워크라고 함.

**호스트 주소**

- 하나의 네트워크 내에 존재하는 호스트를 구분하기 위한 주소.
- IP주소의 네트워크 주소와 호스트 주소는 이 둘을 구분하는 경계점이 고정되어 있지 않음.
- IP 주소 체계는 필요한 호스트 IP 개수에 따라 네트워크의 크기를 다르게 할당할 수 있는 클래스 개념을 도입함.
- A클래스는 가장 큰 주소를 갖는데 약 1,600만 개의 IP주소를 가질 수 있음.
- B클래스 : 약 6만 5천, C클래스 약 250개.

![image](https://user-images.githubusercontent.com/52841715/140639910-3ba7bf2b-2f19-4131-98f2-08da030cf753.png)


- 네트워크의 주소 구분자가 이동할 수 있는 특성으로 인해 네트워크의 크기가 달라질 수 있음.
- 다른 고정 주소체계에 비해 주소를 절약할 수 있는 특징이 있음.

![image](https://user-images.githubusercontent.com/52841715/140639920-71dc50ac-770f-443d-9f83-3c9b34665bde.png)

- A, B, C 클래스는 맨 앞 옥텟의 주소만 보고 구분할 수 있는데 앞 옥
텟의 주소가 0~127의 범위이면 이 주소는 A 클래스이다.
- 첫 옥텟을 이진수로 표기했을 때 2진수 8자리 중 맨 앞 자리가 0인 주소가 A
클래스입니다. 좀 더 풀어서 설명하면 2진수로 첫 옥텟이 0 0000000
~0 1111111인 주소가 A 클래스가 됨. 127만 예외로 자신을 의미하는 루프백(Loopback) 주소로 사용되므로 실제로 A 클래스로 사용할 수 있는 주소는 1.0.0.0~126.255.255.255까지.
- B 클래스는 첫 옥텟을 2진수로 표기했을 때 첫 번째 자리가 1이고 두 번째 자리가 0인 주소가 B 클래스. 2진수로 첫 옥텟이 1000000~10 111111인 수를 10진수로 표현하면 128부터 191까지이고 이 수를 갖는 IP는 B 클래스가 됨.
- C 클래스는 첫 옥텟을 2진수로 표기했을 때 2진수 8자리 중 첫 번째, 두 번째 자리가 1이고 세 번째 자리가 0인 주소가 C 클래스임. 첫 옥텟이 110 00000~110 11111, 10진수로는 192~223까지 IP인경우, C 클래스.
- 클래스 기반의 네트워크 분할 기법은 과거에 사용했던 개념으로 현재는 위에서 설명한 것처럼 클래스 기반으로 네트워크를 분할하지 않음. 보다 네트워크 주소를 세밀하게 분할하고 할당하기 위해 필요한 네트워크의 크기에 맞추어 1비트 단위로 네트워크를 상세히 분할하는 방법을 사용함.

### 클래스풀과 클래스리스

**클래스풀**

- 클래스 기반의 IP 주소 체계.
- IP 주소 체계 도입시에는 클래스 기반 주소 체계가 확장성 있고 주소 낭비가 적은 최적의 구조였음.
- 네트워크 주소와 호스트 주소를 구분짓는 구분자(서브넷 마스크)가 필요 없음.
- 맨 앞자리 숫자를 통해 어느 클래스에 속하는지 구분 할 수 있음.

**IP 주소 부족과 낭비 문제 발생**

- 인터넷의 상용화로 인터넷에 연결되는 호스트 숫자가 폭발적으로 증가함.
- 기존 클래스풀 기반의 주소 체계는 늘어나는 IP 주소 요구를 감당하기에 부족함.
- 이론적으로 사용할 수 있는 IP개수 43억개 but 실제로는 더 적음. 전 세계 인구가 하나의 IP만 갖더라도 모든 인구에게 IP할당 불가.
- 이외에도 네트워크 주소를 계층화하고 분할하기 위해 낭비되는 IP가 매우 많음.
- IP 주소 부족과 낭비 문제를 해결하기 위해 3가지 보존, 전환전략 등장
- 그 중 첫 번째 단기 대책이 클래스리스, CIDR(Classless inter-Domain Routing) 기반의 주소 체계.
- 두 번째 중기 대책은 NAT와 사설 IP주소.
- 세 번째 장기 대책은 차세대 IP인 IPv6.

**클래스리스 등장배경**

- IPv4의 가장 큰 문제는 주소 자체의 부족과 상위 클래스를 할당받은 조직에서 주소들을 제대로 사용하지 못하여 IP공간이 낭비되는 것.
- 여러 회사를 위해 IP를 가장 많이 확보할 수 잇는 A 클래스를 할당받았지만 실제로는 수천, 수만 개만 사용하는 곳이 대부분. 나머지는 활용되지 못함.
- 클래스풀에서는 한 개의 클래스 네트워크가 한 조직에 할당되면 아무리 비어 있는 주소라도 IP를 분할해 다른 기관이 사용하도록 할 수 없음.
- 이 문제를 해결하기 위해 클래스 개념 자체를 버린 클래스리스 등장.

**클래스리스**

- 현재 우리가 사용하는 클래스 개념을 적용하지 않는 주소 체계
- 네트워크와 호스트 주소를 나누는 구분자(서브넷 마스크)를 사용함.

**서브넷 마스크**

- 서브넷 마스크는 IP 주소와 네트워크 주소를 구분할 때 사용.
- 2진수 숫자 1은 네트워크 주소, 0은 호스트 주소로 표시.
- 우리가 편하게 받아들일 수 있는 10진수를 사용해 255.0.0.0, 255.255.0.0, 255.255.255.0와 같이 표현함.
- 2진수 11111111을 10진수로 표현하면 255가 되어 255는 네트워크 주소 부분, 0은 호스트 주소 부분으로 구분됨.
![image](https://user-images.githubusercontent.com/52841715/140639927-c9cb89ad-3d19-4670-9c02-7ed85a39240b.png)

- 서브넷 마스크와 IP주소를 and 연산하여 네트워크 주소와, 호스트 주소를 뽑아냄

![image](https://user-images.githubusercontent.com/52841715/140639936-f2aa40d8-f46d-412c-9cf3-55b3578376f7.png)

- 만약 103.9.32.146 주소에 255.255.255.0 서브넷 마스크를 사용하는 IP는 네트워크 주소가 103.9.32.0이고 호스트 주소는 0.0.0.146이 됨.
- 서브넷 마스크가 2진수 1인 부분(10진수 255인 부분)은 IP 숫자가 그대로 연산 결과가 되고 서브넷 마스크가 0인 부분은 모두 0으로 변경되기 때문.
- 클래스리스 기반의 IP 네트워크에서는 네트워크를 표현하는 데 반드시 서브넷 마스크가 필요하고 서버나 PC에 IP주소를 부여할 때도 사용되어야 함.

![image](https://user-images.githubusercontent.com/52841715/140639939-7390c8ce-d153-43af-bd7c-39632a621eaf.png)

**서브네팅**

- 원래 부여된 클래스의 기준을 무시하고 새로운 네트워크-호스트 구분 기준을 사용자가 정해 원래 클래스풀 단위의 네트워크보다 더 쪼개 사용하는 것.
- 현대 클래스리스 네트워크의 가장 큰 특징.
- 옥텟(8비트) 단위가 아닌 2진수 자리 단위로 서브네팅함.
- 실무에서는 2가지로 서브네팅에 대해 고민해야 함.
- 1) 네트워크 디자인 단계에서 **네트워크 설계자**가 네트워크를 효율적으로 어떻게 분할할 것인지 계획하는 경우.
- 2) 이미 분할된 **네트워크에서 사용자**가 자신의 네트워크와 원격지 네트워크를 구분해야 하는 경우.

**네트워크 사용자의 서브네팅**

- 네트워크에서 사용할 수 있는 IP 범위 파악
- 기본 게이트웨이와 서브넷 마스크 설정이 제대로 되어 있는지 확인.

**자신이 속한 네트워크의 유효 범위를 파악하는 방법**

- 내 IP를 2진수로 표현
- 서브넷 마스크를 2진수로 표현
- 2진수 AND 연산으로 서브네팅된 네트워크 주소를 알아냄.
- 호스트 주소 부분을 2진수 1로 모두 변경해 브로드캐스트 주소를 알아낸다.
- 유효 IP 범위를 파악한다. 서브네팅된 네트워크 주소+1은 유효 IP 중 가장 작은 IP이다.
- 브로드캐스트 주소-1은 유효 IP 중 가장 큰 IP이다.
- 2진수로 연산되어 있는 결괏값을 10진수로 변환한다.

![image](https://user-images.githubusercontent.com/52841715/140639958-a8b95470-4f5c-470e-9863-5826bab3ee41.png)

- 기본 게이트웨이와 서브넷 마스크 설정이 제대로 되어 있는지 확인

**간단한 서브네팅 방법**

- 서브넷 마스크를 2진수로 변환한다.
- 현재의 서브넷이 가질 수 있는 최대 IP 개수 크기를 파악한다. 2^6=64
- 64의 배수로 나열하여 기준이 되는 네트워크 주소를 파악한다.
- 첫 블록은 0부터 시작한다. 각 네트워크의 마지막 주소가 브로드캐스트 주소가 된다. 이 주소는 다음 블록 네트워크 주소의 - 1 수이다.
- 0~63/64~127/128~191/192~255
- 103.9.32.146에서 호스트 주소 146이 속한 네트워크를 선택한다.
- 128~191
- 필요한 주소를 정리한다.
- 네트워크 주소: 103.9.32.128(첫 번째 숫자)
- 브로드캐스트 주소: 103.9.32.191(마지막 숫자)
- 유효 IP 범위: 103.9.32.129 ~ 103.9.32.190(네트워크 주소와
브로드캐스트 주소 사이)

![image](https://user-images.githubusercontent.com/52841715/140639965-5bd6dfc5-3a60-413c-8cc9-8ad13c13fe32.png)

**네트워크 설계자 입장**

- 네트워크 설계 시 네트워크 내에 필요한 단말을 고려한 네트워크 범위 설계
- 네트워크를 새로 구축하는 경우, 네트워크 사용자와 반대로 설계자는 서브넷 마스크가 지정되어 주어지는 것이 아니라 네트워크의 크기를 고민해 서브넷 마스크를 결정
하고 설계에 반영해야 함.
- 네트워크 설계자가 IP를 설계할 때 다음을 고민해야 한다.
- 서브넷된 하나의 네트워크에 IP를 몇 개나 할당해야 하는가?(또는 PC는 몇 대나 있는가?)
- 그리고 서브넷된 네트워크가 몇 개나 필요한가?

**공인 IP와 사설 IP**

- 공인 IP : 인터넷에 접속하려면 IP 주소가 있어야 하고 이 IP는 전 세계에서 유
일해야 하는 식별자임.
- 사설 IP : 인터넷에 연결하지 않고 개인적으로 네트워크를 구성한다면 공인IP 주소를 할당받지 않고도 네트워크를 구축할 수 있음. 이때 사용하는 IP 주소.
- 인터넷에 접속하려면 통신사업자로부터 IP 주소를 할당받거나 IP 할당기관(한국의 경우, KISA)에서 인터넷 독립기관 주소(Autonomous System Number, ASN)를 할당
받은 후 독립 IP를 할당받아야 하므로 절차가 복잡함.
- 인터넷에 접속하지 않거나 NAT(Network Address Translation, 네트워크 주소 변환) 기
술을 사용할 경우(공유기나 회사 방화벽을 사용하는 경우)에는 사설IP 주소를 사용할 수 있습니다. 이 주소들은 인터넷 표준 문서인 RFC에 명시되어 있음.
- 사설 IP를 사용하면 인터넷에 직접 접속하지 못하지만 IP를 변환해주는 NAT 장비에서 공인 IP로 변경한 후에는 인터넷 접속이 가능.
- 가정에서 많이 사용하는 공유기는 NAT 장비의 역할을 하는 대표적인 예.

![image](https://user-images.githubusercontent.com/52841715/140639978-74958038-77e3-46b6-9249-4101303b2a94.png)

**인터넷 표준**

- 인터넷 표준은 특별한 RFC(Request for Comments)와 그 집합을 가리
킴.
- RFC의 원래 의미는 비평을 기다리는 문서로, RFC 자체가 인터넷 표준 문서는 아니며 컴퓨터, 인터넷 기술에 적용할 수 있는 제안, 조사 결과, 아이디어, 표준 등을 적어놓은 메모 형식의 문서 모음(매년 만우절마다 발표되는 만우절 RFC도 있음).
- RFC 문서 중 의미 있는 표준 문서는 국제 인터넷 표준화 기구(Interne
t Engineeing Task Force, IETF)를 통해 표준으로 인정받음.
- 새로운 인터넷 표준이 되는 RFC는 인터넷 드래프트(Draft)로 시작하
고 여러 번의 수정을 거친 후 정식으로 RFC로 출판됨.
- 이후에는 Proposed Standard라는 이름이 붙고 표준으로 인정받음

**공인 IP와 사설 IP2**

- 회사 내부에서 사설 네트워크를 구축할 때 NAT를 사용하여 인터넷
에 연결하더라도 다른 사용자에게 할당된 IP를 사설 네트워크 주소
로 사용하면 안됨.
- 다른 인터넷 연결에는 문제가 없지만 내부 네트워크에 할당된 IP를 공식으로 사용하는 네트워크로 접속할 수 없으므로 인터넷 어느 구간에서도 사용되지 않는 RFC에 명시된 사
설 IP 대역을 사용할 것을 추천.
