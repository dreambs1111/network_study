# [1장: 네트워크 시작 - OSI 7계층](https://uung-dev.tistory.com/19)

# 네트워크 구성과 프로토콜
## 네트워크

네트워크는 서비스를 받는 입장 & 제공하는 입장으로 나뉨

### 1. 홈 네트워크

- 물리적 연결: 모뎀, 공유기, 단말 간에 물리적 연결이 필요
- 무선 연결: 무선 랜 카드와 무선 신호를 보낼 수 있는 매체(공기) 필요
- 유선 연결: 유선 랜 카드, 랜 케이블 필요

### 2.데이터 센터 네트워크

- 안정적이고 빠른 대용량 서비스 제공을 목표로 구성
- 3계층 구성에서 2계층 구성인 스파인-리프 구조로 데이터 센터 네트워크로 변화됨
- 스파인- 리프 구조: 서버 간 통신이 늘어나는 트래픽 경향을 지원하기 위해 제안

## 프로토콜: 네트워크에서 통신할 때의 규약

- 여러가지 프로토콜 기술이 이더넷-TCP/IP 기반 프로토콜들로 획일화 되고 있음
    - 물리적 측면: 데이터 전송 매체, 신호 규약, 회선 규격 → 이더넷이 주로 쓰임
    - 논리적 측면: 장치들끼리 통신히기 위한 프로토콜 규격 → TCP / IP 가 주로 쓰임

## TCP / IP : 프로토콜 스택

OSI 7계층은 네트워크의 주요 레퍼런스 모델로 활용되고, 현대 네트워크는 TCP / IP 스택 기반의 프로토콜과 이더넷으로 되어 있다. TCP / IP 는 4계층으로 이루어져 있고, 이론보다 실용성에 초점을 맞춘 프로토콜이다.

- TCP / IP는 별도 계층에서 동작하는 프로토콜이지만 함께 사용하고 있음. 이런 프로토콜 묶음을 프로토콜 스택이라 함. TCP / IP 프로토콜 스택은 4개 계층으로 이루어져있음
    - 이더넷
    - 네트워크 계층
    - 전송 계층
    - 애플리케이션 계층
---

# OSI 7계층

1~4계층은 Data Flow 계층, 하위 계층이라 불리고, 5~7계층을 Application 계층, 상위 계층이라 부른다.  하위 계층에서는 데이터를 전달하는 데 집중하고, 상위 계층에는 데이터를 만드는 데 집중한다. 이에 네트워크 개발자는 하위 계층에 집중하므로 상향식(bottom-up)으로 네트워크를 바라보고, 애플리케이션 개발자는 하향식(top-down)으로 네트워크를 바라보게 된다.

## 1계층 Physical 계층

- 들어온 전기 신호를 그대로 잘 전달하는 것이 목적.
- [1계층 장비]
    - **허브, 리피터** : 네트워크 통신을 중재함
    - **케이블, 커넥터, 트랜시버**: 컴퓨터 랜 카드와 케이블을 연결함
    - **탭**: 네트워크 모니터링과 패킷 분석을 위해 전기 신호를 다른 장비로 복제함
- 전기 신호가 1계층 장비에 들어오고, 이 신호를 재생성해 내보냄
- 1계층 장비는 주소의 개념이 없으므로 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송
- 0과 1로 이루어진 데이터 ↔ 아날로그 신호로 바꾸어 내보내고 받아들임

## 2계층 Data Link 계층

- 전기 신호를 모아 알아볼 수 있는 데이터로 처리
- 주소 정보를 정의하고 정확한 주소로 통신이 되도록 하는 것에 중점을 둠
- 출발지와 도착지 주소를 확인하고 내게 보낸 것이 맞는 지, 내가 처리해야 하는지에 대해 검사한 후 데이터 처리
- 이더넷 기반 네트워크 2계층에서는 에러를 탐지하는 역할만 수행
- 주소 체계가 생김(MAC 주소) → 동시에 여러 명과 통신할 수 있음 : Flow Control 이 필요함
- [2계층 네트워크 구성 요소]
    - **네트워크 인터페이스 카드**(또는 네트워크 인터페이스 컨트롤러,NIC) : NIC 에는 고유 MAC 주소가 있는데, 입력되는 전기 신호를 데이터 형태로 만들고, 도착지 MAC 주소를 확인한 후 자신에게 들어오는 전기 신호가 맞는지 확인 → 맞다면 상위계층에서 처리할 수 있도록 메모리에 적재, 아니라면 버림
    - **스위치**: 단말들이 통신할 때 포트를 적절히 필터링하고 정확한 포트로 포워딩 해줌 → 이 기능으로 네트워크 전체에 불필요한 처리가 감소해 이더넷 네트워크 효율성이 향상되어, 이더넷 기반 네트워크가 급증하는 계기가 됨

## 3계층 Network 계층

- 데이터 통신 시 2계층의 물리적인 MAC 주소와 3계층의 논리적인 IP 주소가 사용됨
- IP 주소는 사용자가 환경에 맞게 변경해 사용할 수 있고, 네트워크 주소부분과 호스트 주소 부분으로 나뉨
- 3계층을 이해할수 있는 장비는 네트워크 주소 정보를 이용해 자신이 속한 네트워크와 원격지 네트워크를 구분할 수 있고, 원격지 네트워크를 향한 경로를 지정하는 능력이 있음
- 전송단위: 패킷
- [3계층에서 동작하는 장비]
    - 라우터: IP 주소를 사용해 최적의 경로를 찾아주고 해당 경로로 패킷을 전송하는 역할을 함

## 4계층 Transport 계층

- 데이터들이 정상적으로 잘 보내지도록 확인하는 역할
- 패킷이 유실되거나 순서가 바뀌었을 때 바로잡아 주는 역할
- 4계층에서 패킷을 분할할 때 패킷 헤더에 보내는 순서와 받는 순서를 적어서 통신함. 패킷이 유실되면 재전송을 요청할 수 있고, 순서가 뒤바뀌더라도 바로잡을 수 있음
    - 시퀀스 번호: 패킷에 보내는 순서 명시
    - ACK 번호: 패킷을 받는 순서를 나타냄
- TCP(신뢰성 있는 통신), UDP(데이터를 빠르게 전달하는데에 초점을 둔 비연결형 프로토콜) 프로토콜이 있는 계층
- 전송단위: Segment
- [4계층에서 동작하는 장비]
    - 로드 밸런서, 방화벽: 애플리케이션 구분자(포트번호)와 시퀀스, ACK 번호 정보를 이용해 부하를 분산하거나 보안 정책을 수립해 패킷을 통과, 차단하는 기능을 수행함

## 5계층 Session 계층

- 양 끝단의 응용 프로세스가 연결을 성립하도록 도와주고 연결이 안정적으로 유지되도록 관리→ 작업 완료 후 이 연결을 끊음
- 세션을 관리하는 것이 주요 역할. TCP / IP 세션을 만들고 없앰
- 에러로 중단된 통신에 대한 에러 복구와 재전송 수행 (세션 도커의 체크포인트를 이용)

## 6계층 Presentation 계층

- 표현방식이 다른 애플리케이션, 시스템 간의 통신을 돕기 위해 하나의 통일된 구문 형식으로 변환시킴
- 사용자 시스템의 응용 계층에서 데이터의 형식상 차이를 다루는 부담을 덜어줌
- MIME 인코딩, 암호화, 압축, 코드변환이 이루어짐

## 7계층 Application 계층

- 애플리케이션 프로세스를 정의하고 서비스를 수행함
- 소프트웨어의 UI, 사용자의 입출력 부분을 정의
- HTTP, FTP, SMTP, Telnet과 같은 프로토콜이 이에 속함

---

# 인캡슐레이션과 디캡슐레이션

- 인캡슐레이션: 데이터를 보내는 과정 (상위계층에서 하위계층으로 데이터를 보내고, 물리 계층에서 전기 신호 형태로 네트워크를 통해 신호를 보냄)
- 디캡슐레이션: 데이터를 받는 과정 (하위계층에서 상위계층으로 받은 데이터를 보냄)

패킷 네트워크란? 현대 네트워크는 대부분 패킷 기반 네트워크임. 데이터를 패킷이라는 작은 단위로 쪼개, 하나의 통신이 회선 전체를 점유하지 않고 동시에 여러 단말이 통신하도록 해줌. 패킷을 받는 쪽에서 다시 패킷들을 큰 데이터 형태로 결합해 사용함

패킷 네트워크 작업은 2가지 정보 흐름으로 설명됨

- 인캡슐레이션, 디캡슐레이션 과정을 통해 데이터가 전송되는 과정
- 각 계층 헤더를 이용해 송신자 계층과 수신자 계층간의 논리적 통신과정

1. 보내는 작업 
    - 패킷에 데이터를 분할해서 넣음 (인캡슐레이션)
    - 데이터를 패킷에 담을 때 각 계층 별로 자신이 필요한 정보를 헤더에 붙힘
    - 4계층→3계층→2계층으로 내려가며 필요한 헤더정보를 비트단위(0,1)로 작성
    
    ⇒ 데이터 하나를 전송하면 하위 계층에서만 3개의 헤더정보가(4,3,2계층)가 추가됨
    
2. 받는 작업
    - 디캡슐레이션 과정 수행
    - 받은 전기 신호를 데이터 형태로 2계층으로 올려보냄
    - 2계층에서 2계층 헤더에 포함된 정보를 확인하고 목적지가 자신이 맞는지 확인
    - 목적지가 맞다면 2계층의 헤더정보를 벗겨내고 나머지를 3계층으로 올려보냄
    - 3계층 → 4계층도 마찬가지
    
    ⇒ 데이터를 애플리케이션에 올려보냄
    

정리: 데이터는 상위계층 → 하위계층, 하위계층 → 상위계층으로 전달. 헤더 정보는 각 계층끼리 전달.

## 헤더 정보

데이터를 인캡슐레이션 하는 과정에 헤더에 넣는 정보가 많아 모두 이해하기 힘듬. 

프로토콜마다 특성이 달라 적어넣는 정보가 다르지만, 이러한 복잡한 정보들에도 규칙이 있고, 다음 두가지 정보는 반드시 포함되어야 함

### 1. 현재 계층에서 정의하는 정보

OSI 7계층의 각 계층에서의 목적에 맞는 정보들이 포함됨

- 4계층 : 데이터에 순서를 정하고, 받은 패킷의 순서가 맞는지, 빠진 패킷은 없는지 점검함. 이 정보를 헤더에 넣음.
    - TCP/IP의 4계층 프로토콜인 TCP에서 시퀀스, 애크 번호 필드오 이 데이터를 표현함
- 3계층: 출발지, 도착지 IP 주소를 헤더에 넣음
- 2계층: 출발지, 도착지 MAC 주소 정보를 헤더에 넣음

### 2. 상위 프로토콜 지시자

프로토콜 스택은 상위 계층으로 올라갈수록 종류가 많아짐

인캡슐레이션 과정에서는 상위 프로토콜이 많아도 되지만, 디캡슐레이션하는 목적지 쪽에서는 헤더에 아무 정보가 없으면 어떤 상위 프로토콜로 올려보내 주어야 하는지 결정할 수 없음

그래서, 인캡슐레이션 하는 쪽에서 헤더에 상위 프로토콜 지시자 정보를 포함해야함

각 계층마다 상위 프로토콜 지시자를 가지고, 그 명칭이 다름

- 4계층: 포트 번호 - 애플리케이션 계층에서 프로토콜 종류를 나타내주는 정보
- 3계층: 프로토콜 번호
- 2계층 이더 타입

⇒ 동작하는 계층보다 한계층 위의 정보가 적혀 있게 됨