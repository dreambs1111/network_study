# 보안 개념

네트워크 보안의 목표는 외부 네트워크로부터 내부 네트워크를 보호하는 것이다. 

- 외부로부터 보호받아야 할 네트워크를 트러스트(Trust) 네트워크, 신뢰할 수 없는 외부 네트워크를 언트러스트(Untrust) 네트워크로 구분한다.
- 운영하는 내부 네트워크를 신뢰할 수 없는 외부 사용자에게 개방해야 하는 서비스 네트워크인 경우, DMZ(DeMilitarized Zone) 네트워크라고 부르며 일반적으로 인터넷에 공개되는 서비스를 이 네트워크에 배치한다.
- 네트워크 보안 분야는 트래픽의 방향과 용도에 따라 두 가지로 나눌 수 있다
    - **인터넷 시큐어 게이트웨이(Internet Secure Gateway)**: 트러스트(또는 DMZ) 네트워크에서 언트러스트 네트워크로의 통신을 통제 → 인터넷으로 나갈 때는 인터넷에 수많은 서비스가 있으므로 그에 대한 정보와 요청 패킷을 적절히 인식하고 필터링하는 기능이 필요
    - **데이터 센터 시큐어 게이트웨이(Data Center Secure Gateway)**: 언트러스트 네트워크에서 트러스트(또는 DMZ)로의 통신을 통제 → 데이터 센터 게이트웨이는 상대적으로 고성능 장비가 필요하고 외부의 직접적인 공격을 막아야하므로 인터넷 관련 정보보다 외부 공격 관련 정보가 더 중요

# 보안 솔루션의 종류

데이터 센터에서 보안 장비를 디자인할 때 **DDoS - 방화벽 - IPS - WAF** 형태와 같이 여러 단계로 공격을 막도록 인라인 상에 여러 장비를 배치해 단계적으로 방어한다. 

## DDoS 방어 장비

DoS 공격은 ‘Denial of Service’ 공격의 약자로, 다양한 방법으로 공격 목표에 서비스 부하를 가해 정상적인 서비스를 방해하는 공격 기법이다. DoS 공격 기법이 발전해 짧은 시간 안에 공격 성과를 내기 위해 다수의 봇(bot)을 이용해 분산 공격을 수행하는 DDoS 공격 기법이 등장했다. 이 DDoS 공격을 방어하는 것이 DDoS 보안 장비이다. 

DDoS 장비는 데이터 센터 네트워크 내부와 외부의 경계에서 공격을 방어하는데, 볼류메트릭 공격(Volumetric Attack)을 우선 막기 위해서다. 이 볼류메트릭 공격은 회선 사용량이나 그 이상의 트래픽을 과도하게 발생시켜 회선 사용을 방해하는 공격이다. 이 공격 시, 회선을 공급해주는 ISP나 네트워크 ISP와 연결되는 데이터 센터 네트워크의 가장 바깥쪽에 위치시켜 이 공격을 완화해야 한다.

# 방화벽

방화벽은 4계층에서 동작하는 패킷 필터링 장비이다. 3, 4계층 정보를 기반으로 정책을 세울 수 있고 해당 정책과 매치되는 패킷이 방화벽을 통과하면 그 패킷을 허용하거나 거부할 수 있다.

기존 패킷 필터 방화벽이 패킷의 상태값 없이 순수하게 정책만으로 제어하던 한계를 극복하기 위해 개발된 것이 상태기반 방화벽이다. 현재 우리가 방화벽이라고 부르는 모든 장비는 세션 기반으로 동작하는 상태 기반(SPI) 엔진을 탑재하고 있다. 패킷 필터는 가볍고 빠르지만 통신의 양방향성을 인지하지 못하고 단순히 패킷이 조건과 일치하는지만 검사한다.

---

# IPS, IDS

방화벽은 3,4 계층 방어만 가능해 애플리케이션 계층에서 이루어지는 공격을 방어할 수 없다. 애플리케이션 공격은 서비스를 제공하는 시스템 자체의 취약점을 이용하는 경우가 많아 애플리케이션 계층에서 이루어지는 공격을 탐지, 방어하기 위해 개발되었다.

IDS(Intrusion Detection System: 침입 탐지 시스템)와 IPS(Intrusion Prevention System: 침입 방지 시스템) 는 방화벽에서 방어할 수 없는 다양한 애플리케이션 공격을 방어하는 장비다. 기존에는 IDS, IPS 장비를 구분했지만 최근에는 애플리케이션 공격을 방어하는 장비를 IPS로 통칭한다.

- IPS는 호스트 기반 IPS와 네트워크 기반 IPS가 있다.
    - 엔드 포인트 보안이 강조될 때는 호스트 기반 IPS 솔루션, 네트워크 보안이 강조될 때는 네트워크 IPS 장비들을 사용함
    - 일반적으로 IPS라고 부르는 시스템은 네트워크 기반 NIPS임

## IPS, IDS 동작방식

- 패턴 매칭 방식: 기존 공격이나 취약점을 통해 공격 방식에 대한 데이터베이스를 습득하고 최신 내용을 유지해 공격을 파악하는 기술. 시그니처 방식, 데이터 베이스 방식 방어라고도 함. 이런 패턴 기반 방어가 IPS 기능의 상당 부분을 차지해 IPS 는 많은 공격 데이터베이스를 보유한다.
- 어노말리 공격 방어: 패턴 기반의 방어는 기존 공격의 작은 변화에도 적절한 대응이 어려웠고, 변종 웜 공격을 막아내기 어려워 화이트리스트 기반의 방어 기법인 어노말리 기법이 개발되었다. 어노말리 기법은 분명한 공격으로 파악되지 않더라도 특정 기준 이상의 행위를 이상하다고 판단하고 방어하게 된다
    - 프로파일 어노말리: 평소 관리자가 정해놓은 기준이나 IPS 장비가 모니터링해 정해진 기준과 다른 행위가 일어나면 공격으로 판단함. 평소와 다른 행위에 초점을 맞춘다. 예를 들어 웜이 감염되면 다른 타깃으로 다량의 트래픽을 발생시켜 감염시키는 행위를 반복하는데, 이런 형태의 공격을 평소와 다른 수많은 트래픽 발생을 잡아내어 방어할 수 있는 것이다.
    - 프로토콜 어노말리: SPI 방화벽과 NAT 기능 때문에 해커가 직접 일반 사용자의 PC를 직접 공격하기 어려워져, 방화벽을 우회해 내부 사용자가 악성 코드를 내려받아 실행하도록 유도한다. 이런 악성코드에 감염된 좀비 PC는 정상적으로 서비스를 요청하는 것처럼 동작해 일반 방화벽에서 이런 공격에 대한 탐지와 방어가 불가능하다. 이런 공격을 방어하기 위해 프로토콜 어노말리 기법이 사용된다. 좀비 PC가 외부와 공격을 위한 통신을 할 때 기존의 프로토콜이 아닌 다른 프로토콜을 사용하는 경우가 흔해 이를 파악해 공격을 의심한다.

⇒ IPS는 근본적인 문제가 있다. 네트워크 상에서 애플리케이션 레벨까지 확인하기 위해 플로(Flow)엔진을 사용하는데, 플로 엔진은 패킷이 흘러가는 상황을 모니터링해 공격을 탐지해 IPS 장비를 비교적으로 쉽게 우회할 수 있다. 또한 IPS는 오탐이 많이 발생하기에 최적화 작업이 지속적으로 필요하다. 이러한 문제점을 해결한 NGIPS 개념의 장비가 출시되며, IPS쪽 다양한 장비가 통합되는 추세이다.

# DDoS 방어 장비

방화벽 대중화 이전의 공격 방식은 직접 공격해 관리자 권한을 탈취하는 데 초점이 맞추어져 있었다면, 이후의 공격은 정상적인 서비스가 불가능하도록 방해하는데 초점이 맞추어져 있다. 이 공격 방식을 DoS(Denial of Service)라 하고, 다수의 공격자를 만들어 DoS 공격을 하는 DDoS 공격 방식이 발전하게 되었다. 이런 공격을 방어하기 위한 DDoS 전용 장비를 살펴보자.

![스크린샷 2022-01-09 오후 7.59.02.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d9668880-0d45-4ef4-9cfc-3c4795973219/스크린샷_2022-01-09_오후_7.59.02.png)

- DDoS 방어 장비는 볼류메트릭 공격을 방어하기 위해 트래픽 프로파일링 기법을 주로 사용하고 (기존보다 과도한 트래픽이 인입되면 알려주고 차단함) 인터넷의 다양한 공격 정보를 수집한 데이터베이스를 활용한다. (IP 평판 데이터베이스를 공유해 DDoS 공격으로 사용된 IP 기반으로 방어 여부를 결정하거나 특정 공격 패턴을 방어하는 방법이 있음.)
- DDoS 공격을 탐지해 공격을 수행하는 IP 리스트를 넘겨주면 방어 장비에서 해당 IP를 버리는 것이 가장 흔한 DDoS 방어 기법이다.
- DDoS 방어 기법은 탐지 및 방어를 하나의 장비에서 하는 **인라인 방법**, 탐지 및 방어를 다른 장비에서 수행하는 **아웃 오브 패스** 두가지 방법이 대표적이다.
    
    ![스크린샷 2022-01-09 오후 8.04.51.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/08c32feb-49e6-4f83-8e4e-44fb0cfd1963/스크린샷_2022-01-09_오후_8.04.51.png)
    

## DDoS 공격 타입

### 1. 볼류메트릭 공격

볼류메트릭 공격은 회선 사용량이나 그 이상의 트래픽을 과도하게 발생시켜 회선을 사용하지 못하도록 방해하는 공격이므로 회선을 공급해주는 ISP 내부나 사용자 네트워크 최상단에 위치시켜 이 공격을 완화해야 한다. DDoS 장비는 주로 볼류메트릭 공격이나 프로토콜 공격을 방어하는 데 사용되고, 회선을 공급하는 ISP와 공조해 방어해야 하는 경우도 있다.

![스크린샷 2022-01-09 오후 8.51.04.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f23110ec-4ae2-4d68-91b4-c3cb1667659e/스크린샷_2022-01-09_오후_8.51.04.png)

볼류메트릭 공격 방어를 위해 **클라우드 기반의 DDoS 방어 서비스**도 고려해볼 수 있다. 클라우드 기반 서비스는 DDoS, WAF(Web Appli cation Firewall)과 같은 별도의 보안 장비 없이도 다양한 DDoS 공격을 방어할 수 있다는 장점이 있다. 실제 서비스 서버 앞에서 미리 클라이언트의 요청을 받아 처리한 후 문제가 없는 요청만 서버 쪽으로 전달해 실제 서비스 네트워크가 가려져 대규모 볼류메트릭 공격도 큰 투자 없이 방어할 수 있다.

### 2. 프로토콜 공격

3, 4계층 프로토콜 스택의 취약점을 악용해 대상을 액세스할 수 있게 만드는 공격이다. 공격 대상의 처리용량을 모두 사용해 서비스 중단을 유발한다. 일반적인 네트워크 장비나 네트워크 보안 장비를 대상으로 하는 경우가 많다. 공격 대상 장비의 CPU, 메모리 자원을 고갈시켜 정상적인 서비스가 불가능하게 한다.

### 3. 애플리케이션 공격

7계층 프로토콜 스택의 약점을 악용하는 공격이라, 가장 정교하고 대처하기 까다로운 공격이다. 대상과의 연결을 설정한 후 프로세스와 트랜잭션을 독점해 서버 자원을 소모시킨다. 애플리케이션 프로토콜 자체의 취약점이나 서비스를 제공하는 플랫폼의 취약점을 악용하는 경우가 많다.

# VPN

VPN(Virtual Private Network)은 물리적인 전용선이 아닌 공중망을 이용해 논리적으로 직접 연결한 것처럼 망을 구성하는 기술이다. 터널링 기법(직접 연결된 것처럼 작동하는 망)만 제공할 수 있다면 VPN이라 할 수 있지만, 이 기법을 전용선과 같은 사설망으로 사용하기 위해서는 강력한 보안을 제공해야 한다. 그래서 IPSEC, SSL과 같은 암호화 기법을 제공하는 프로토콜이 VPN에 주로 사용된다.

VPN은 가상 네트워크를 만들어 주는 장비로 패킷을 터널링 프로토콜로 감싸 통신하는 터널링 기법을 사용한다. 패킷을 암호화하거나 인증하거나 무결성을 체크하는 보안 기능을 이용해 인터넷에 패킷이 노출되더라도 해커나 기관들이 감청하지 못하도록 보호할 수 있다.

일반적으로 VPN은 3가지 형태로 구현된다

- Host to Host 통신 보호 (두 호스트 간에 직접 VPN 터널을 연동하는 기법) : 일반적으로 VPN 구성으로 잘 사용하지 않는다.
- Network to Network 통신 보호: 본사-지사와 같은 특정 네트워크를 가진 두 종단을 연결하며 IPSEC 프로토콜 스택을 가장 많이 사용한다.
    
    ![스크린샷 2022-01-09 오후 8.40.06.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f45266be-368f-4eef-b9f0-6f1b2dfe412f/스크린샷_2022-01-09_오후_8.40.06.png)
    
- Host가 Network로 접근할 때 보호: 모바일 사용자가 일반 인터넷 망을 통해 사내망으로 연결하며 IPSEC와 SSL 프로토콜이 범용적으로 사용된다.
    
    ![스크린샷 2022-01-09 오후 9.37.00.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/127cc8ea-8bb1-4c2d-8476-6eceae701535/스크린샷_2022-01-09_오후_9.37.00.png)