# 스위치 : 2계층 장비
> ## [4.1] 스위치 장비 동작
> ## [4.2] VLAN
> ## [4.3] STP
---
```
스위치 : 네트워크 중간에서 패킷을 받아 필요한 곳에만 보내주는 네트워크 중재자 역활

스위치는 아무 설정 없이 네트워크에 연결해도 MAC 주소를 기반으로 패킷을 전달할 수 있음

스위치의 기능
    - 기본 기능 (패킷을 전달)
    - VLAN : 한 대의 장비에서 논리적으로 네트워크를 분리
    - STP : 네트워크의 루프를 방지
```
---
> ## [4.1] 스위치 장비 동작
- 스위치 : 네트워크에서 통신을 중재하는 장비
    - 스위치가 없던 오래된 이더넷 네트워크 : 패킷전송시 서로 경합으로 인한 네트워크 성능저하가 컸음
    - 스위치를 사용하면 여러 단말이 한꺼번에 통신할 수 있어 패킷의 병목현상이 해결되고 통신 효율성이 향상됨

- 스위치의 핵심 역할 : 누가 어느 위치에 있고 실제 통신이 시작되면 알고있는 위치로 패킷을 정확히 전송하는 것
    - 이런 동작에서 스위치가 2계층 주소를 이해하고 MAC주소와 단말이 위치하는 인터페이스 정보를 매핑한 MAC 주소 테이블을 갖고 있어서 가능
    (그림 4.4)
    - **_스위치 작동_**
        1. 전송하려는 패킷의 헤더 안에 2계층 목적지 주소 확인
        2. MAC 주소 테이블에서 해당주소 포트 확인
        3. 해당 패킷 그 포트로 전송
        - 이런 역할을 수행하기 위해 스위치는 MAC주소와 포트가 매핑된 MAC 주소 테이블이 필요
        - if 테이블에 없는 도착지 주소를 가진 패킷
            - 전체 포트로 패킷 전송
        - if 테이블에 주소가 존재
            - 매핑된 포트로만 패킷 전송

__스위치의 이런 동작 방식을 다음 3가지로 정리 가능__
```
1. 플러딩(Flooding)
2. 어드레스 러닝(Address Learning)
3. 포워딩/필터링(Fowarding/Filtering)
```
> ### [4.1.1] 플러딩(Flooding)
- 스위치는 부팅시 네트워크 관련 아무런 정보가 없음
    - 이때의 스위치는 네트워크 통신을 중재하는 역할을 못하고 허브처럼 동작
        - 허브는 패킷이 들어온 포트를 제외 모든 포트로 패킷을 전달
        - 스위치가 허브와 같이 작동되는 동작방식을 플러딩이라 한다
        (그림 4.6)
        - 스위치는 LAN에서 동작하므로 자신이 정보를 갖고 있지 않더라도 어딘가에 장비가 있을수 있다고 가정하기 때문
- 플러딩은 스위치의 정상적인 동작이지만 요청이 많아지면 스위치에 부하가 걸림
- 패킷이 스위치에 들어오면 해당 패킷 정보의 MAC 주소를 보고 이를 학습해 MAC 주소 테이블을 만든 후 이를 통해 패킷을 전송

__비정상적인 플러딩__
```
- 스위치가 패킷을 플러딩한다는것은 제 기능을 못한다는뜻(물론 동작자체는 정상이지만)
- 아무 이유없이 스위치가 패킷을 플러딩한다면 고장 또는 외부의 공격임을 알아야한다
    - 엉뚱한 MAC주소를 습득시키거나 MAC테이블을 꽉 차게 해 플러딩유도가능
    - 또는 ARP포이즈닝 기법을 이용해 모니터링해야 할 IP의 MAC주소가 공격자 자신인것처럼 속여 통신하는 방법을 사용하기도 함
```

> ### [4.1.2] 어드레스 러닝
- 스위치가 패킷의 도착지 MAC주소를 확인하고 원하는 포트로 포워딩시 MAC주소 테이블의 생성과 유지가 필요
    - MAC주소 테이블
        - 어느 포트에 어떤 장비가 연결되어 있는지에 대해 정보가 저장된 임시 테이블
- 이런 MAC주소 테이블을 만들고 유지하는 과정을 어드레스 러닝이라고 한다.

- 어드레스 러닝
    - 패킷의 출발지 MAC주소 정보를 이용
    - 패킷이 특정 포트에 들어오면 스위치에는 해당 패킷의 출발지MAC주소와 포트번호를 MAC주소 테이블에 기록
        - ex. N번포트에서 들어온 패킷의 출발MAC주소가 1111이라면 N번포트에 1111맥주로를가진 장비가 있다
    - 어드레스 러닝은 출발지의 MAC주소를 사용하므로 브로드캐스트나 멀티캐스트에 대한 MAC주소를 학습할 수 없다
        - 이유 : 두가지 모두 목적지 MAC주소 필드에서만 사용하기 때문

 
