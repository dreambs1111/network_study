# 로드 밸런서/방화벽 : 4계층 장비(세션 장비)

> ## 6.1 4계층 장비의 특징
> ## 6.2 로드 밸런서
> ## 6.3 방화벽
> ## 6.4 4계층 장비를 통과할 때의 유의점(세션 관리)
---
> ## 6.1 4계층 장비의 특징
- 4계층 장비는 TCP와 같은 4계층 헤더에 있는 정보를 이해하고 이 정보들을 기반으로 동작
- 4계층 프로토콜 동작에 대한 깊은 이해 없이 4계층 장비를 2,3계층 네트워크 장비처럼 설계, 운용하면 여러가지 문제가 발생한다

- 기존 네트워크 장비와 다른 점을 위주로 이해해보기
    - 세션 테이블과 그 안에서 관리하는 세션 정보가 가장 중요
    - 4계층 이상에서 동작하는 로드밸런서, 방화벽과 같은 장비를 '세션 장비'라고 부른다

> __세션 테이블__

- 세션 장비는 세션 테이블 기반으로 운영
- 세션 정보를 저장, 확인하는 작업 전반에 대한 이해 필요
- 세션 정보는 세션 테이블에 남아있는 라이프타임이 존재(이부분 고려 필요)

- Symmetric(대칭)경로 요구
    - Inbound / Outbound 경로 일치 요구
- 정보 변경(로드밸런서의 경우)
    - IP주소가 변경되며 확장된 L7 로드 밸런서(ADC)는 애플리케이션 프로토콜 정보도 변경된다

__세션 장비의 이런 요소들은 서비스에 영향을 끼칠수 있으므로 방화벽, NAT, 로드밸런서(네트워크 중간에서 세션을 기반으로 동작하는 기능들)와 같은 장비들은 네트워크 인프라 뿐 아니라 시스템 설계, 애플리케이션 개발에서도 세션 장비에 대해 고려해야 한다__

> ## 6.2 로드밸런서
- 로드 밸런서 : 서버나 장비의 부하를 분산하기 위해 사용하는 장비
- 기능 :트래픽을 분배
    - 4계층 이상에서 동작하면서 IP주소나 4계층 정보, 애플리케이션 정보를 확인, 수정하는 기능도 있다

- 가장 많이 사용되는 분야 : 웹서버의 부하 분산
    - 이유 : 사용자 1천 명의 요청을 처리해주는 서버보다 5천명의 요청을 동시에 처리해주는 서버는 5배보다 훨씬 비싸기 때문
    - 따라서 작은 장비 여러 대를 묶어 사용하는 방법을 선호

- 작은 시스템 여러 대를 운영하더라도 사용자는 서버의 배치와 상관없이 하나의 서비스로 보여야 한다

- 로드 밸런서가 서비스에 사용하는 대표IP를 갖고 그 하위에 시스템이 늘어나면 로드밸런서가 각 시스템의 실제 IP로 알아서 변경해서 요청을 보낸다
- 4, 7계층의 로드밸런서?
    > L4 로드 밸런싱
    - 일반적인 로드밸런서가 동작하는 방식
    - TCP, UDP정보